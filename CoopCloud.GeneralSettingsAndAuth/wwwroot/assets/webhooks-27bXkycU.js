import{R as c,t as e,w as N}from"./index-BjhtngU2.js";import{w as C,y as w,at as L,au as O,ap as F,aq as f,I as E,as as R,av as M,B as y,aw as W,ax as x,ao as z,ay as K,az as B,K as p}from"./index-BzCiW6fY.js";import{A,I as D,S as U}from"./status-badge-C4aKdise.js";import{s as G,w as J}from"./vest-DWm3oUc2.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],H=C("pen",q);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],Q=C("play",$);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],k=C("trash",X),Y=[{value:"loan.created",label:"Préstamo Creado"},{value:"loan.updated",label:"Préstamo Actualizado"},{value:"loan.approved",label:"Préstamo Aprobado"},{label:"Pago Recibido",value:"payment.received"},{label:"Pago Vencido",value:"payment.overdue"},{label:"Cliente Nuevo",value:"customer.created"},{value:"customer.updated",label:"Cliente Actualizado"}],Z=[{label:"Préstamos",value:"Préstamos"},{label:"Pagos",value:"Pagos"},{label:"Clientes",value:"Clientes"},{label:"Notificaciones",value:"Notificaciones"},{label:"Reportes",value:"Reportes"}],ee=[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"PUT",value:"PUT"},{label:"PATCH",value:"PATCH"},{label:"DELETE",value:"DELETE"}],j={url:"",event:"",headers:[],category:"",method:"POST",statusId:A},ae=({onHide:o,webhook:l,onSubmitSuccess:d,...g})=>{const v=w({defaultValues:l||j,resolver:G(J)}),{reset:r,control:n}=v,{append:u,fields:h,remove:m}=L({control:n,name:"headers"});c.useEffect(()=>{l&&r(l)},[r,l]);const i=c.useCallback(()=>{r(j)},[r]);return e.jsx(O,{...g,modal:!0,form:v,className:"min-w-2xl",title:l?"Editar webhook":"Nuevo webhook",submitLabel:l?"Guardar cambios":"Crear webhook",subtitle:"Configura los detalles del endpoint de notificación.",onHide:()=>{i(),o==null||o()},onSubmit:s=>{d==null||d(s),i(),o==null||o()},children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs(F,{gap:3,cols:2,children:[e.jsx(f,{name:"event",label:"Evento",options:Y,placeholder:"Seleccionar evento"}),e.jsx(f,{name:"category",label:"Categoría",options:Z,placeholder:"Seleccionar categoría"}),e.jsx(f,{name:"method",label:"Método HTTP",options:ee,placeholder:"Seleccionar método"})]}),e.jsx(E,{name:"url",label:"URL",placeholder:"https://..."}),e.jsx(R,{label:"Activo",name:"isActive",description:"El webhook estará habilitado para recibir eventos"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(M,{children:"Headers"}),e.jsx(y,{size:"sm",type:"button",variant:"outline",onClick:()=>u({field:"",value:""}),children:"Agregar Header"})]}),h.length>0&&e.jsx("div",{className:"space-y-2",children:h.map((s,b)=>e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx(E,{label:"",fieldClassname:"flex-1",placeholder:"Content-Type",name:`headers.${b}.field`}),e.jsx(E,{label:"",fieldClassname:"flex-1",placeholder:"application/json",name:`headers.${b}.value`}),e.jsx(y,{size:"icon",type:"button",variant:"ghost",onClick:()=>m(b),children:e.jsx(k,{className:"h-4 w-4"})})]},s.id))})]})]})})},te=[{id:"1",method:"POST",category:"Préstamos",event:"loan.created",statusId:A,url:"https://api.negocio.com/webhooks/loans"},{id:"2",method:"POST",category:"Pagos",event:"payment.received",statusId:D,url:"https://erp.interno.com/sync"}],le=[{value:"loan.created",label:"Préstamo Creado"},{value:"loan.updated",label:"Préstamo Actualizado"},{value:"loan.approved",label:"Préstamo Aprobado"},{label:"Pago Recibido",value:"payment.received"},{label:"Pago Vencido",value:"payment.overdue"},{label:"Cliente Nuevo",value:"customer.created"},{value:"customer.updated",label:"Cliente Actualizado"}],oe=()=>{const{setSearch:o,tableState:l,setFilters:d,setSorting:g,setPagination:v,setJoinOperator:r}=W([{id:"id",desc:!0}]),[n,u]=c.useState(te),[h,m]=c.useState(!1),[i,s]=c.useState(null),b=a=>{if(i)u(n.map(t=>t.id===i.id?{...t,...a}:t)),p.success("Webhook actualizado");else{const t={...a,id:Math.random().toString()};u([...n,t]),p.success("Webhook creado")}s(null)},T=a=>{s(a),m(!0)},_=a=>{u(n.filter(t=>t.id!==a.id)),p.success("Webhook eliminado")},S=a=>{p.promise(new Promise(t=>setTimeout(t,1e3)),{error:"Error al enviar evento",loading:"Enviando evento de prueba...",success:`Evento de prueba enviado a ${a.url} (200 OK)`})},I=c.useMemo(()=>[{id:"event",header:"Evento",accessorKey:"event",enableColumnFilter:!0,meta:{variant:"text",label:"Evento"},cell:({row:a})=>{var P;const t=a.getValue("event");return((P=le.find(V=>V.value===t))==null?void 0:P.label)||t}},{id:"category",header:"Categoria",accessorKey:"category",enableColumnFilter:!0,meta:{variant:"text",label:"Categoria"},cell:({row:a})=>x(a.getValue("category"))},{id:"url",header:"URL",accessorKey:"url",enableColumnFilter:!0,meta:{label:"URL",variant:"text"},cell:({row:a})=>x(a.getValue("url"))},{id:"method",header:"Método",accessorKey:"method",enableColumnFilter:!0,meta:{variant:"text",label:"Método"},cell:({row:a})=>x(a.getValue("method"))},{id:"statusId",header:"Estado",enableSorting:!1,accessorKey:"statusId",enableColumnFilter:!0,cell:({row:a})=>e.jsx(U,{value:a.getValue("statusId")}),meta:{options:[],label:"Estado",variant:"select"}}],[]);return e.jsxs(e.Fragment,{children:[e.jsx(z,{title:"Webhooks",subtitle:"Configura webhooks para notificar a sistemas externos sobre eventos.",actions:e.jsxs(y,{onClick:()=>{s(null),m(!0)},children:[e.jsx(K,{className:"h-4 w-4"}),"Agregar Webhook"]})}),e.jsx(B,{data:n,columns:I,onSearch:o,onSorting:g,getRowId:a=>a.id,sorting:l.sorting,onPagination:v,onAdvancedFilters:d,searchValue:l.search,advancedFilters:l.filters,joinOperator:l.joinOperator,onJoinOperatorChange:r,actions:[{icon:Q,label:"Probar",onClick:S},{icon:H,label:"Editar",onClick:T},{icon:k,label:"Eliminar",onClick:_}]}),e.jsx(ae,{visible:h,onSubmitSuccess:b,onHide:()=>m(!1),webhook:i||void 0})]})},ce=N(oe);export{ce as default};
